<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Android App端与PHP Web端的简单数据交互实现 · Uknow - Stay hungry Stay foolish</title><meta name="description" content="Android App端与PHP Web端的简单数据交互实现 - uknow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/2.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="http://weibo.com/uknowsec" target="_blank" class="nav-list-link">Weibo</a></li><li class="nav-list-item"><a href="https://github.com/uknowsec" target="_blank" class="nav-list-link">GitHub</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Android App端与PHP Web端的简单数据交互实现</h1><div class="post-time">Oct 23, 2017</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于学校科技立项的项目需要实现Android App端与PHP Web端的简单数据交互的实现，当前场景是Web端使用的是MySql数据库，Apache服务器和PHP语言编写的。数据交互的简单理解就是Android能向服务端进行数据获取，同时也能进行数据提交。</p>
<h2 id="实现流程"><a href="#实现流程" class="headerlink" title="实现流程"></a>实现流程</h2><p><img src="http://obr4sfdq7.bkt.clouddn.com/webandorid%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt=""></p>
<h3 id="流程说明"><a href="#流程说明" class="headerlink" title="流程说明"></a>流程说明</h3><ul>
<li>Andorid Server端对MySql数据库进行简单的查询操作，并将查询数据结果转换为Json格式提供给Andorid利用OKhttp读取再解析Json展示到APP上；同时Andorid端利用OKhttp提交给Andorid Server端，由Server端对MySql数据库对提交数据的添加。</li>
<li>Apache Server端通过解析PHP源代码，对MySql数据库的增删查改显示在WebSite。</li>
</ul>
<h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="Andorid-Server"><a href="#Andorid-Server" class="headerlink" title="Andorid Server"></a>Andorid Server</h3><h4 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h4><p>get_all_found_items.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">header(&apos;Content-Type:text/html;charset=utf-8&apos;);/*设置php编码为utf-8*/</span><br><span class="line">/* </span><br><span class="line"> * Following code will list all the items </span><br><span class="line"> */  </span><br><span class="line">   </span><br><span class="line">// array for JSON response  </span><br><span class="line">$response = array();  </span><br><span class="line">   </span><br><span class="line">// include db connect class  </span><br><span class="line">require_once __DIR__ . &apos;/db_connect.php&apos;;  </span><br><span class="line">   </span><br><span class="line">// connecting to db  </span><br><span class="line">$db = new DB_CONNECT();  </span><br><span class="line">   </span><br><span class="line">// get all items from items table  </span><br><span class="line">$result = mysql_query(&quot;SELECT *FROM items WHERE type=&apos;1&apos;&quot;) or die(mysql_error());  </span><br><span class="line">// check for empty result  </span><br><span class="line">if (mysql_num_rows($result) &gt; 0) &#123;  </span><br><span class="line">    // looping through all results  </span><br><span class="line">    // items node  </span><br><span class="line">    $response[&quot;items&quot;] = array();  </span><br><span class="line">   </span><br><span class="line">    while ($row = mysql_fetch_array($result)) &#123;  </span><br><span class="line">        // temp user array  </span><br><span class="line">        $items = array();  </span><br><span class="line">        $items[&quot;what&quot;] = $row[&quot;what&quot;];  </span><br><span class="line">        $items[&quot;when&quot;] = $row[&quot;when&quot;];  </span><br><span class="line">        $items[&quot;where&quot;] = $row[&quot;where&quot;];  </span><br><span class="line">        $items[&quot;detail&quot;] = $row[&quot;detail&quot;];</span><br><span class="line">        $items[&quot;posttime&quot;] = $row[&quot;posttime&quot;];			</span><br><span class="line">		$resultcontcat = mysql_query(&quot;SELECT *FROM guests&quot;) or die(mysql_error()); </span><br><span class="line">		while ($row1 = mysql_fetch_array($resultcontcat)) &#123; </span><br><span class="line">			if ($row1[&quot;id&quot;] == $row[&quot;gid&quot;])&#123;</span><br><span class="line">				$items[&quot;contact&quot;] = $row1[&quot;contact&quot;];</span><br><span class="line">			&#125;</span><br><span class="line">			&#125;</span><br><span class="line">        // push single items into final response array  </span><br><span class="line">        array_push($response[&quot;items&quot;], $items);  </span><br><span class="line">    &#125;  </span><br><span class="line">    // success  </span><br><span class="line">    $response[&quot;success&quot;] = 1;  </span><br><span class="line">   </span><br><span class="line">    // echoing JSON response  </span><br><span class="line">    echo json_encode($response,JSON_UNESCAPED_UNICODE); </span><br><span class="line">&#125; else &#123;  </span><br><span class="line">    // no items found  </span><br><span class="line">    $response[&quot;success&quot;] = 0;  </span><br><span class="line">    $response[&quot;message&quot;] = &quot;No items found&quot;;  </span><br><span class="line">   </span><br><span class="line">    // echo JSON  </span><br><span class="line">    echo json_encode($response,JSON_UNESCAPED_UNICODE);  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>如以上PHP代码可知通过require_once()函数包含db_connect.php文件，执行数据库配置文件。定义数组\$response接收查询的数据结果，通过判断不同的情况赋值$response[“success”]，并返回到Web页面显示</p>
<p>PHP文件执行结果<br><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%8B%BC%E9%9F%B3%E6%88%AA%E5%9B%BE20171023110706.png" alt=""></p>
<p>JSON<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;items&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;what&quot;: &quot;手表&quot;,</span><br><span class="line">            &quot;when&quot;: &quot;2017-10-21 00:00:00&quot;,</span><br><span class="line">            &quot;where&quot;: &quot;北区宿舍楼#504&quot;,</span><br><span class="line">            &quot;detail&quot;: &quot;白色的手表，XX品牌&quot;,</span><br><span class="line">            &quot;posttime&quot;: &quot;2017-10-21 13:03:09&quot;,</span><br><span class="line">            &quot;contact&quot;: &quot;138123456&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;what&quot;: &quot;手机&quot;,</span><br><span class="line">            &quot;when&quot;: &quot;2017-10-04 00:00:00&quot;,</span><br><span class="line">            &quot;where&quot;: &quot;北区商店#111&quot;,</span><br><span class="line">            &quot;detail&quot;: &quot;iphone6s,土豪金&quot;,</span><br><span class="line">            &quot;posttime&quot;: &quot;2017-10-21 13:03:46&quot;,</span><br><span class="line">            &quot;contact&quot;: &quot;137123456&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;what&quot;: &quot;电脑&quot;,</span><br><span class="line">            &quot;when&quot;: &quot;2017-10-21 14:39:54&quot;,</span><br><span class="line">            &quot;where&quot;: &quot;图书馆#203&quot;,</span><br><span class="line">            &quot;detail&quot;: &quot;联想品牌笔记本&quot;,</span><br><span class="line">            &quot;posttime&quot;: &quot;2017-10-21 17:08:14&quot;,</span><br><span class="line">            &quot;contact&quot;: &quot;5670001&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;what&quot;: &quot;细说PHP&quot;,</span><br><span class="line">            &quot;when&quot;: &quot;2017-09-21 13:03:46&quot;,</span><br><span class="line">            &quot;where&quot;: &quot;南馆#403&quot;,</span><br><span class="line">            &quot;detail&quot;: &quot;黑色封面，第二版《细说PHP》&quot;,</span><br><span class="line">            &quot;posttime&quot;: &quot;2017-10-21 17:36:53&quot;,</span><br><span class="line">            &quot;contact&quot;: &quot;63513641&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;success&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="提交数据"><a href="#提交数据" class="headerlink" title="提交数据"></a>提交数据</h4><p>create_found_items.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">header(&apos;Content-Type:text/html;charset=utf-8&apos;);/*设置php编码为utf-8*/   </span><br><span class="line">/* </span><br><span class="line"> * Following code will create a new product row </span><br><span class="line"> * All product details are read from HTTP GET Request </span><br><span class="line"> */  </span><br><span class="line">   </span><br><span class="line">// array for JSON response  </span><br><span class="line">$response = array();  </span><br><span class="line">   </span><br><span class="line">// check for required fields  </span><br><span class="line">if (isset($_GET[&apos;what&apos;]) &amp;&amp; isset($_GET[&apos;when&apos;]) &amp;&amp; isset($_GET[&apos;where&apos;]) &amp;&amp; isset($_GET[&apos;detail&apos;])&amp;&amp; isset($_GET[&apos;contact&apos;])) &#123;  </span><br><span class="line">   </span><br><span class="line">    $what = $_GET[&apos;what&apos;];  </span><br><span class="line">    $when = $_GET[&apos;when&apos;];  </span><br><span class="line">    $where = $_GET[&apos;where&apos;];  </span><br><span class="line">    $detail = $_GET[&apos;detail&apos;]; </span><br><span class="line">    $contact = $_GET[&apos;contact&apos;];	</span><br><span class="line">	</span><br><span class="line">    // include db connect class  </span><br><span class="line">    require_once __DIR__ . &apos;/db_connect.php&apos;;  </span><br><span class="line">   </span><br><span class="line">    // connecting to db  </span><br><span class="line">    $db = new DB_CONNECT();  </span><br><span class="line">   </span><br><span class="line">    // mysql inserting a new row  </span><br><span class="line">	$result2 = mysql_query(&quot;INSERT INTO guests(contact) VALUES(&apos;$contact&apos;)&quot;);  </span><br><span class="line">	$gidresult = mysql_query(&quot;SELECT id FROM `guests` WHERE contact=&apos;$contact&apos;&quot;);	</span><br><span class="line">	while ($row = mysql_fetch_array($gidresult)) &#123; </span><br><span class="line">			$gid=$row[&apos;id&apos;];</span><br><span class="line">		&#125;</span><br><span class="line">    $result1 = mysql_query(&quot;INSERT INTO items(`what`, `when`, `where`, `type` ,`gid`, `detail`) VALUES(&apos;$what&apos;, &apos;$when&apos;, &apos;$where&apos;, &apos;1&apos;, &apos;$gid&apos;, &apos;$detail&apos;)&quot;);   </span><br><span class="line">   </span><br><span class="line">    // check if row inserted or not  </span><br><span class="line">    if ($result1 &amp;&amp; $result2) &#123;  </span><br><span class="line">        // successfully inserted into database  </span><br><span class="line">        $response[&quot;success&quot;] = 1;  </span><br><span class="line">        $response[&quot;message&quot;] = &quot;Items successfully created.&quot;;  </span><br><span class="line">   </span><br><span class="line">        // echoing JSON response  </span><br><span class="line">    echo json_encode($response,JSON_UNESCAPED_UNICODE);   </span><br><span class="line">    &#125; else &#123;  </span><br><span class="line">        // failed to insert row  </span><br><span class="line">        $response[&quot;success&quot;] = 0;  </span><br><span class="line">        $response[&quot;message&quot;] = &quot;Oops! An error occurred.&quot;;  </span><br><span class="line">   </span><br><span class="line">        // echoing JSON response  </span><br><span class="line">    echo json_encode($response,JSON_UNESCAPED_UNICODE);   </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; else &#123;  </span><br><span class="line">    // required field is missing  </span><br><span class="line">    $response[&quot;success&quot;] = 0;  </span><br><span class="line">    $response[&quot;message&quot;] = &quot;Required field(s) is missing&quot;;  </span><br><span class="line">   </span><br><span class="line">    // echoing JSON response  </span><br><span class="line">    echo json_encode($response,JSON_UNESCAPED_UNICODE);   </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>判断GET请求的参数是否都存在，把获取的GET请求参数作为数据INSERT TO MySQL数据库。判断INSERT执行过程赋值\$response[“success”]对应相应的$response[“message”]，显示在Web页面。</p>
<p>执行结果<br><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E5%9B%BE%E7%89%8720171023111323_%E7%9C%8B%E5%9B%BE%E7%8E%8B.png" alt=""></p>
<h3 id="Andorid"><a href="#Andorid" class="headerlink" title="Andorid"></a>Andorid</h3><h4 id="获取数据-1"><a href="#获取数据-1" class="headerlink" title="获取数据"></a>获取数据</h4><p>核心代码 queryLosts()函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">private void queryLosts() &#123;</span><br><span class="line">	losts.clear();</span><br><span class="line">	new Thread(new Runnable() &#123;</span><br><span class="line">		</span><br><span class="line">		@Override</span><br><span class="line">		public void run() &#123;</span><br><span class="line">			// TODO Auto-generated method stub</span><br><span class="line">			</span><br><span class="line">	        OkHttpClient okHttpClient = new OkHttpClient();</span><br><span class="line">	        String url = &quot;http://webSite/androidapi/get_all_lost_items.php&quot;;</span><br><span class="line">	        Request request = new Request.Builder()</span><br><span class="line">	                .url(url)</span><br><span class="line">	                .build();</span><br><span class="line">	        Call call = okHttpClient.newCall(request);</span><br><span class="line">	        try &#123;</span><br><span class="line">	            Response response = call.execute();</span><br><span class="line">	            String res = response.body().string();</span><br><span class="line">	            if (res != null &amp;&amp; !res.trim().equals(&quot;&quot;))&#123;</span><br><span class="line">	                JSONObject jsonObject = new JSONObject(res);</span><br><span class="line">	                if (jsonObject.getInt(&quot;success&quot;) == 1)&#123;</span><br><span class="line">	                    JSONArray jsonArray = jsonObject.getJSONArray(&quot;items&quot;);</span><br><span class="line">	                    for (int i = jsonArray.length() - 1;i &gt;= 0;i--)&#123;</span><br><span class="line">	                        JSONObject item = jsonArray.getJSONObject(i);</span><br><span class="line">	                        String what = null;</span><br><span class="line">	                        try &#123;</span><br><span class="line">	                            what = item.getString(&quot;what&quot;);</span><br><span class="line">	                        &#125;catch (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">	                        &#125;</span><br><span class="line">	                        String when = null;</span><br><span class="line">	                        try&#123;</span><br><span class="line">	                            when = item.getString(&quot;when&quot;);</span><br><span class="line">	                        &#125;catch (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">	                        &#125;</span><br><span class="line">	                        String where = null;</span><br><span class="line">	                        try&#123;</span><br><span class="line">	                            where = item.getString(&quot;where&quot;);</span><br><span class="line">	                        &#125;catch (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">	                        &#125;</span><br><span class="line">	                        String detail = null;</span><br><span class="line">	                        try &#123;</span><br><span class="line">	                            detail = item.getString(&quot;detail&quot;);</span><br><span class="line">	                        &#125;catch (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">	                        &#125;</span><br><span class="line">	                        String contact = null;</span><br><span class="line">	                        try &#123;</span><br><span class="line">	                            contact = item.getString(&quot;contact&quot;);</span><br><span class="line">	                        &#125;catch (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">	                        &#125;</span><br><span class="line">	                        Lost lost = new Lost();</span><br><span class="line">	                        lost.setTitle(what);</span><br><span class="line">	                        String des = &quot;地点：&quot; + (where == null?&quot;&quot;:where) +&quot;     &quot;+&quot;时间：&quot; + (when == null?&quot;&quot;:when)+&quot;\r&quot; + &quot;     &quot;+&quot;描述：&quot; + (detail == null?&quot;&quot;:detail);</span><br><span class="line">	                        lost.setDescribe(des);</span><br><span class="line">	                        lost.setPhone(contact == null?&quot;&quot;:contact);</span><br><span class="line">	                        losts.add(lost);</span><br><span class="line">	                    &#125;</span><br><span class="line">	                &#125;</span><br><span class="line">	            &#125;</span><br><span class="line">	        &#125; catch (Exception e) &#123;</span><br><span class="line">	            e.printStackTrace();</span><br><span class="line">	            showErrorView(0);</span><br><span class="line"></span><br><span class="line">	        &#125;</span><br><span class="line">	        if (losts == null || losts.size() == 0) &#123;</span><br><span class="line">	        	handler.sendEmptyMessage(1);</span><br><span class="line">	            return;</span><br><span class="line">	        &#125;</span><br><span class="line">	        if (losts.size() &gt; 0)&#123;</span><br><span class="line">	           handler.sendEmptyMessage(2);</span><br><span class="line">	        &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;).start();</span><br></pre></td></tr></table></figure>
<p>利用Android网络框架OKhttp,OKhttp一个处理网络请求的开源项目,是安卓端最火热的轻量级框架.请求接口url地址，获取Json数据利用JSONObject对Json数据进行解析。</p>
<h4 id="提交数据-1"><a href="#提交数据-1" class="headerlink" title="提交数据"></a>提交数据</h4><p>核心代码 addLost()函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public Handler handler = new Handler()&#123;</span><br><span class="line"></span><br><span class="line">	public void handleMessage(android.os.Message msg) &#123;</span><br><span class="line">		switch(msg.what)&#123;</span><br><span class="line">			case 1:</span><br><span class="line">				Toast.makeText(this,&quot;提交成功&quot;,Toast.LENGTH_LONG).show();</span><br><span class="line">				break;</span><br><span class="line">			case 2:</span><br><span class="line">				Toast.makeText(this,&quot;提交失败&quot;,Toast.LENGTH_LONG).show();</span><br><span class="line">				break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">private void addLost()&#123;</span><br><span class="line">	OkHttpClient okHttpClient = new OkHttpClient();</span><br><span class="line">	String url =&quot;http://website/androidapi/create_lost_items.php?what=&quot;+title+&quot;&amp;when=&quot;+time+&quot;&amp;where=&quot;+place+&quot;&amp;detail=&quot;+describe+&quot;&amp;contact=&quot;+photo+&quot;&quot;;</span><br><span class="line">	Request request = new Request.Builder()</span><br><span class="line">			.url(url)</span><br><span class="line">			.build();</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	try&#123;</span><br><span class="line">		Response response = okHttpClient.newCall(request).execute();</span><br><span class="line">		res = response.body().string();</span><br><span class="line">		handler.sendEmptyMessage(1);</span><br><span class="line">	&#125;catch (Exception e)</span><br><span class="line">	&#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		handler.sendEmptyMessage(2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样利用Okhttp,GET方式提交参数，try-catch获取异常，通过返回值给出一定的提交结果提示。</p>
<h2 id="代码测试"><a href="#代码测试" class="headerlink" title="代码测试"></a>代码测试</h2><h3 id="数据同步"><a href="#数据同步" class="headerlink" title="数据同步"></a>数据同步</h3><h4 id="Web端"><a href="#Web端" class="headerlink" title="Web端"></a>Web端</h4><p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%8B%BC%E9%9F%B3%E6%88%AA%E5%9B%BE20171023112834.png" alt=""></p>
<h4 id="Andorid端"><a href="#Andorid端" class="headerlink" title="Andorid端"></a>Andorid端</h4><p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E5%9B%BE%E7%89%8720171023112949.jpg" alt=""></p>
<h3 id="数据提交"><a href="#数据提交" class="headerlink" title="数据提交"></a>数据提交</h3><p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E5%9B%BE%E7%89%8720171023113352.jpg" alt=""></p>
<p>提交结果</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/Screenshot_2017-10-23-11-42-14-803_com.bmob.lostf.jpg" alt=""></p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%8B%BC%E9%9F%B3%E6%88%AA%E5%9B%BE20171023114405.png" alt=""></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>以上过程基本实现，项目基本上可以交差了。这个项目PHP部分主要是由自己在弄，也是边学边做。Android方面是另外一个同学主要负责，期间也求助过我实习时结交的朋友帮助。感谢所有付出与帮助的人。</p>
</div></article></div></section><footer><div class="paginator"><a href="/posts/notes/php支持的协议和封装协议小结.html" class="prev">PREV</a><a href="/posts/notes/PHP-MVC开发框架学习笔记.html" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2018 <a href="http://uknowsec.cn">uknow</a>  Stay hungry,Stay foolish.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-115504647-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?225ebcce29d319519ac7c7690425d1d4";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>